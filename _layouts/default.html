<!DOCTYPE html>
	<html>
		<head>
			<title>{{ page.title }}</title>
			<!-- link to main stylesheet -->
			<link rel="stylesheet" type="text/css" href="/css/main.css">
			<link rel="stylesheet" type="text/css" href="/css/animation.css">
			<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">			
			<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon.png">
			<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
			<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
		</head>
		<body>
		<div class="header">
			<div id="nav_container">
				<nav >
					<ul>
						<li><a href="/">Projects</a></li>
						<li><a href="/resume">Resume</a></li>
						<li><a href="/about">About</a></li>
					</ul>
				</nav>
			</div>
			<div id="canvas_container">
				<canvas id="canvas" height="30" width="60"></canvas>
			</div>
			<div id="imageAddress" title="My current location: Lausanne, Switzerland">
			</div>â€‹


		</div>
			<div class="container">
			
			{{ content }}
			
			</div><!-- /.container -->
			<script>
			//canvas variables
			var canvas = document.querySelector('canvas'), divParent = document.getElementById('canvas_container'),
				styleSheetHeart = document.styleSheets[1], myReq;
			var ctx = canvas.getContext("2d"); 
			var scaleFactor = 0.7;
			canvas.width = divParent.clientWidth*scaleFactor;
			
			//timer variables
			var fps = 25, interval = 1000/fps, lastTime = (new Date()).getTime(),
				currentTime = 0, delta = 0, timerRunning = false;
			
			var settingsCanvas = new SettingsLineCanvas(0, 3);
			var lineCanvas = new LineCanvas(3, '#E74C3C');
			var zigZagCanvas = new ZigZagCanvas(3, 15, 20, '#E74C3C');
			
			window.addEventListener('load', function load(event){
				window.removeEventListener('load', load, false);
				initCanvas();
			});
			window.addEventListener('resize', resize, false);
			function resize(event){
				initCanvas();
			}
			function SettingsLineCanvas(distance, stepX){
				this.distance = distance;								
				this.height = canvas.height/2;
			}
			function LineCanvas(stepX, color){
				this.stepX = stepX;
				this.color = color;
				this.draw = function() {
					ctx.beginPath();
					ctx.strokeStyle = this.color;
					ctx.moveTo(settingsCanvas.distance, settingsCanvas.height); 
					settingsCanvas.distance += this.stepX;
					ctx.lineTo(settingsCanvas.distance, settingsCanvas.height);
					ctx.stroke();
					
				}
			}			
			function ZigZagCanvas(stepX, stepUpY, stepDownY, color ){
				this.stepX = stepX;
				this.stepUpY = stepUpY;
				this.stepDownY = stepDownY;
				this.color = color;
				this.draw = function() {
					var _random = getRandom()*getRandomSign();
					var _distance = settingsCanvas.distance;
					var _height = settingsCanvas.height + _random;
					ctx.strokeStyle = this.color;
					ctx.beginPath();
					ctx.moveTo(_distance, _height);
					
					//move up
					_distance += this.stepX;
					_height -= this.stepUpY;
					ctx.lineTo(_distance, _height);
					
					//move down
					_distance += this.stepX;
					_height += this.stepDownY;
					ctx.lineTo(_distance, _height);	
					
					//move up	
					_distance += this.stepX;
					ctx.lineTo(_distance, settingsCanvas.height);
					
					settingsCanvas.distance = _distance;
					ctx.stroke();
					
				}
			}

			function initCanvas(){
				canvas.width = divParent.clientWidth*scaleFactor;
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				settingsCanvas.distance = 0;
				cancelAnimationFrame(myReq);
				myReq = requestAnimationFrame(drawHeartBeat);	
			}

			function drawHeartBeat(){

				if(settingsCanvas.distance > canvas.width) settingsCanvas.distance = 0;
				myReq = requestAnimationFrame(drawHeartBeat);
				
				currentTime = (new Date()).getTime();
				delta = currentTime - lastTime;
				
				if(delta > interval){

					ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
					ctx.fillRect(0, 0, canvas.width, canvas.height);
				
					if(heartBeat()) {
						zigZagCanvas.draw();
					}				
					else {
						lineCanvas.draw();
					}
					lastTime = currentTime - (delta % interval);
				}	
			}
								
			function heartBeat() {
				var beat = (getRandom() < 0.08) ? checkTimerHeart() : false;
				return beat;
			}
			function checkTimerHeart(){
				if(timerRunning != true){
					heartAnimation(true);
					timerRunning = true;
					setTimeout(timerEvent,300);
					return true;
				}
				return false;
			}
			function timerEvent(){ 
				timerRunning = false;
				heartAnimation(false);
			}
			function getRandom() {
				return Math.random();
			}
			function getRandomSign(){
				return sign = Math.round(Math.random()) * 2 - 1;
			}
			function heartAnimation(bool){
				if(bool) styleSheetHeart.insertRule('#imageAddress { animation: beat 0.2s ease alternate;}',0);
				else styleSheetHeart.deleteRule(0);
			}
		
			
			</script>
			<footer>
	    		<ul>
	        		<li><a href="mailto:trushinskiy.a@gmail.com">email</a></li>
	        		<li><a href="https://github.com/timatrue">github.com/timatrue</a></li>
				</ul>
			</footer>
		</body>
	</html>
